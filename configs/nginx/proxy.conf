## Version 2026-01-30 - Refactored for Clarity
# ----------------------------------------------------------------------
# 1. ESSENTIALS (Keep these enabled for almost all setups)
# ----------------------------------------------------------------------
# Basic Proxy Headers - Passes real IP and scheme to the backend
proxy_set_header Host $host;
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
proxy_set_header X-Forwarded-Proto https;
proxy_set_header X-Forwarded-Ssl on;
proxy_set_header X-Forwarded-Host $host;

# WebSocket Support - Automatically upgrades connections if requested
proxy_http_version 1.1;
proxy_set_header Upgrade $http_upgrade;
proxy_set_header Connection "upgrade";

# Standard Optimization
proxy_set_header Proxy "";
proxy_set_header Early-Data $ssl_early_data;

# Security - Hide internal NGINX headers from response
proxy_hide_header X-Content-Type-Options;

# ----------------------------------------------------------------------
# 2. OPTIONAL / SITUATIONAL (Uncomment if needed or add to specific server/location)
# ----------------------------------------------------------------------

# --- TIMEOUTS ---
# Enable for long-running processes (e.g., large file uploads, heavy reports)
# Default NGINX timeout is usually 60s. The below sets it to 1 hour.
# proxy_read_timeout 3600s;
# proxy_send_timeout 3600s;
# proxy_connect_timeout 300s;

# --- BUFFERS ---
# Enable if your app sends large headers (e.g., big Cookies, OAuth tokens)
# or if you see "upstream sent too big header" errors.
# proxy_buffer_size 128k;
# proxy_buffers 4 256k;
# proxy_busy_buffers_size 256k;
# proxy_headers_hash_bucket_size 128;
# proxy_headers_hash_max_size 1024;

# --- CACHE BYPASS ---
# Enable if your backend uses a cookie named 'session' to manage login state.
# This prevents NGINX from caching private user pages.
# proxy_cache_bypass $cookie_session;
# proxy_no_cache $cookie_session;

# --- LOAD BALANCING ---
# Enable if you have multiple backend servers defined in an 'upstream' block.
# This retries the next server if the current one fails.
# proxy_next_upstream error timeout invalid_header http_500 http_502 http_503;
